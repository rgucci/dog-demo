# Images Demo App - TinkLabs Coding Test

This project is based on [work](https://github.com/ribot/android-boilerplate) created by [ribot](http://ribot.co.uk) as a reference for new Android projects.
Libraries and tools included:

- Support libraries
- RecyclerViews and CardViews 
- [RxJava](https://github.com/ReactiveX/RxJava) and [RxAndroid](https://github.com/ReactiveX/RxAndroid) 
- [Retrofit 2](http://square.github.io/retrofit/)
- [Dagger 2](http://google.github.io/dagger/)
- [Butterknife](https://github.com/JakeWharton/butterknife)
- [Timber](https://github.com/JakeWharton/timber)
- [Glide](https://github.com/bumptech/glide)
- [AutoValue](https://github.com/google/auto/tree/master/value) with extensions [AutoValueParcel](https://github.com/rharter/auto-value-parcel) and [AutoValueGson](https://github.com/rharter/auto-value-gson)
- Functional tests with [Espresso](https://google.github.io/android-testing-support-library/docs/espresso/index.html)
- [Robolectric](http://robolectric.org/)
- [Mockito](http://mockito.org/)
- [Checkstyle](http://checkstyle.sourceforge.net/), [PMD](https://pmd.github.io/) and [Findbugs](http://findbugs.sourceforge.net/) for code analysis

## Software Requirements

- JDK 1.8
- [Android SDK](http://developer.android.com/sdk/index.html).
- Android N [(API 24) ](http://developer.android.com/tools/revisions/platforms.html).
- Latest Android SDK Tools and build tools.


## Architecture

This project uses Android architecture guidelines that are based on [MVP (Model View Presenter)](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter). Read more about them [here](https://github.com/ribot/android-guidelines/blob/master/architecture_guidelines/android_architecture.md). 

![](https://github.com/ribot/android-guidelines/raw/master/architecture_guidelines/architecture_diagram.png)

## App Description

- This app displays live search results from the Google Image Search API.
- there are 3 tabs. Each tab displays a different search query related to: travel, food, and shopping.
- the search results are loaded on demand. If the tab is not yet selected, the query will not be executed
- there are 2 kinds of items in search results: normal items (with title, description, image) and image only items
- only 10 items at a time are returned by the search query.
- list implements infinite scroll: once the end of the list is reached, if there are more than 10 items, the search query for the next page will be executed and the next 10 items) will be displayed
- clicking an item on the list will open the web browser to display the web page that contains the image

## Backend API

This project uses Google's custom Image Search API (free tier) which has the following limitations:
- Daily quota of 1000 requests
- 100 maximum result items per search
- 100 queries per 100 seconds
- the API limits each result page to **exactly** 10 items
 
If any of these limitations are exceeded, the API will return HTTP 40x errors. If this happens, just wait for a while, then re-run the search.

Another important note, to simulate the requirement for two different items in the search results, the app will make **every 3rd** result (i.e. 3, 13, 23, 33, 43, 53, 63, 73, 83, 93) into an **Image Only** item. All other items will be normal items.

## Code Quality

This project integrates a combination of unit tests and functional tests. 

Unit tests are provided by the following classes:

- ResultItemTest
- ImageSearchManagerTest
- DataManagerTest
- ListPresenterTest
- MainPresenterTest

Functional tests are provided for the following classes:

- MainActivityTest

### Test Details

#### ResultItemTest

Tests the correctness of mapping from Google Image Search result **SearchItem** to the domain object **Item** 

#### ImageSearchManagerTest

Tests the the correctness of the logic converting the Google API result into the domain search result object used by the app.

- test one search result
- test multiple search results (10)
- test search result with no items
- test getting the next page of results
- test getting search item past 100 (should return no results, as limited by the API)

In the unit test, the real API is not executed. Instead, a mock ImageSearchEndpoint is created, and the simulated test results are generated by SearchResultGenerator.

#### DataManagerTest

Tests that this class delegates the correct calls to the helper classes. Note the stub for ImageSearch interface and the mock object created does not actually call the API.

This also has a test to check that the BrowserHelper delegate is called correctly.

#### ListPresenterTest

Tests the Presenter logic for displaying the list:

- test displaying multiple items in the list
- test displaying no items in the list
- test displaying an error when retrieving the list data
- test displaying the item selected

There are three mock objects created for this test:

- the "fragment" to display the list. Note that a real Android fragment is **NOT** created and a mock "View" is created instead.
- the mock DataManager to create test data
- the mock BrowserHelper to test item selection

#### MainPresenterTest

Tests the Presenter logic for displaying the main activity and the tabs. Note that a real Android activity is **NOT** created, and a mock "View" is created instead.

#### MainActivityTest

This test provides a simple integration test to check if the UI elements are displayed correctly. It uses Espresso to simulate the UI interactions.

Note that this test requires an Android device or simulator.

### Running Tests

To run **unit** tests on your machine:

``` 
./gradlew test
``` 

To run **functional** tests on connected devices:

``` 
./gradlew connectedAndroidTest
``` 

Note: For Android Studio to use syntax highlighting for Automated tests and Unit tests you **must** switch the Build Variant to the desired mode.

## License

```
    Copyright 2018 Russell JVM Gutierrez

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
```

